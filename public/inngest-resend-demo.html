<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Event-Driven Workflows Demo</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }
        .panel {
            flex: 1;
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .panel h2 {
            margin-top: 0;
            color: #333;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }
        .event-log {
            height: 300px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
            background-color: #f8f9fa;
            font-family: monospace;
            font-size: 14px;
        }
        .event-item {
            padding: 8px;
            border-bottom: 1px solid #eee;
        }
        .event-item:last-child {
            border-bottom: none;
        }
        .event-time {
            color: #666;
            font-size: 0.9em;
        }
        .event-name {
            font-weight: bold;
            color: #007bff;
        }
        .btn {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        .btn:hover {
            background-color: #0056b3;
        }
        .btn-secondary {
            background-color: #6c757d;
        }
        .btn-secondary:hover {
            background-color: #545b62;
        }
        .btn-success {
            background-color: #28a745;
        }
        .btn-success:hover {
            background-color: #1e7e34;
        }
        .btn-warning {
            background-color: #ffc107;
            color: #212529;
        }
        .btn-warning:hover {
            background-color: #e0a800;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        .notification {
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 15px;
        }
        .notification.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .notification.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>
<body>
    <h1>Event-Driven Workflows Demo</h1>
    <p>This demo shows how Inngest and Nodemailer work together to handle event-driven workflows and email notifications.</p>
    
    <div class="container">
        <!-- Event Testing Panel -->
        <div class="panel">
            <h2>Event Testing</h2>
            <div class="form-group">
                <label for="event-type">Event Type</label>
                <select id="event-type">
                    <option value="task.created">Task Created</option>
                    <option value="doc.updated">Document Updated</option>
                    <option value="chat.message">Chat Message</option>
                    <option value="email.notification">Email Notification</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="task-title">Task Title (for task events)</label>
                <input type="text" id="task-title" value="Sample Task">
            </div>
            
            <div class="form-group">
                <label for="document-title">Document Title (for document events)</label>
                <input type="text" id="document-title" value="Sample Document">
            </div>
            
            <div class="form-group">
                <label for="message">Message (for chat/email events)</label>
                <textarea id="message" rows="3">This is a sample message for testing event-driven workflows.</textarea>
            </div>
            
            <div class="form-group">
                <label for="recipient-email">Recipient Email (for email events)</label>
                <input type="email" id="recipient-email" value="test@example.com">
            </div>
            
            <button id="send-event" class="btn">Send Event</button>
            <button id="clear-log" class="btn btn-secondary">Clear Log</button>
        </div>
        
        <!-- Event Log Panel -->
        <div class="panel">
            <h2>Event Log</h2>
            <div id="event-log" class="event-log">
                <div class="event-item">
                    <div class="event-time">[10:00:00]</div>
                    <div class="event-name">System</div>
                    <div>Event log initialized</div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="panel">
        <h2>Background Jobs</h2>
        <p>Background jobs are automatically triggered by events and can include:</p>
        <ul>
            <li>Automatic retry of failed jobs</li>
            <li>Deadline reminders (1 hour before due date)</li>
            <li>LLM summarization for large documents</li>
            <li>Chat message notifications</li>
            <li>Document update notifications</li>
        </ul>
        <button id="simulate-job" class="btn btn-success">Simulate Background Job</button>
        <button id="simulate-failure" class="btn btn-warning">Simulate Job Failure</button>
    </div>

    <script>
        // DOM elements
        const eventTypeEl = document.getElementById('event-type');
        const taskTitleEl = document.getElementById('task-title');
        const documentTitleEl = document.getElementById('document-title');
        const messageEl = document.getElementById('message');
        const recipientEmailEl = document.getElementById('recipient-email');
        const sendEventBtn = document.getElementById('send-event');
        const clearLogBtn = document.getElementById('clear-log');
        const eventLogEl = document.getElementById('event-log');
        const simulateJobBtn = document.getElementById('simulate-job');
        const simulateFailureBtn = document.getElementById('simulate-failure');
        
        // Add event to log
        function addEventToLog(eventName, details) {
            const eventItem = document.createElement('div');
            eventItem.className = 'event-item';
            eventItem.innerHTML = `
                <div class="event-time">[${new Date().toLocaleTimeString()}]</div>
                <div class="event-name">${eventName}</div>
                <div>${details}</div>
            `;
            
            eventLogEl.insertBefore(eventItem, eventLogEl.firstChild);
            
            // Limit log to 50 items
            if (eventLogEl.children.length > 50) {
                eventLogEl.removeChild(eventLogEl.lastChild);
            }
        }
        
        // Send event
        function sendEvent() {
            const eventType = eventTypeEl.value;
            let details = '';
            
            switch (eventType) {
                case 'task.created':
                    details = `Task: ${taskTitleEl.value}`;
                    addEventToLog('Task Created', `Created task "${taskTitleEl.value}"`);
                    break;
                case 'doc.updated':
                    details = `Document: ${documentTitleEl.value}`;
                    addEventToLog('Document Updated', `Updated document "${documentTitleEl.value}"`);
                    break;
                case 'chat.message':
                    details = `Message: ${messageEl.value.substring(0, 50)}...`;
                    addEventToLog('Chat Message', `Sent message: "${messageEl.value.substring(0, 50)}..."`);
                    break;
                case 'email.notification':
                    details = `To: ${recipientEmailEl.value}`;
                    addEventToLog('Email Notification', `Sent email to ${recipientEmailEl.value}`);
                    break;
            }
            
            // In a real app, this would send the event to Inngest
            console.log(`Sending event: ${eventType}`, { details });
        }
        
        // Clear log
        function clearLog() {
            eventLogEl.innerHTML = '';
            addEventToLog('System', 'Event log cleared');
        }
        
        // Simulate background job
        function simulateBackgroundJob() {
            addEventToLog('Background Job', 'Starting document summarization job...');
            
            setTimeout(() => {
                addEventToLog('Background Job', 'Document summarization completed successfully');
            }, 2000);
        }
        
        // Simulate job failure
        function simulateJobFailure() {
            addEventToLog('Background Job', 'Starting deadline reminder job...');
            
            setTimeout(() => {
                addEventToLog('Background Job', 'Job failed: Email service unavailable');
                addEventToLog('Background Job', 'Retrying job in 5 seconds...');
                
                setTimeout(() => {
                    addEventToLog('Background Job', 'Job completed successfully on retry');
                }, 5000);
            }, 1500);
        }
        
        // Event listeners
        sendEventBtn.addEventListener('click', sendEvent);
        clearLogBtn.addEventListener('click', clearLog);
        simulateJobBtn.addEventListener('click', simulateBackgroundJob);
        simulateFailureBtn.addEventListener('click', simulateJobFailure);
        
        // Initialize
        addEventToLog('System', 'Event-driven workflows demo initialized');
    </script>
</body>
</html>